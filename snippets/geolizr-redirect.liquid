{% if shop.metafields.geolizr.redirect_widget_enabled %}
    <script>
        Geolizr.init(function($) {
            let body = $('body');
            body.addClass('geolizr-redirect-loading');
            Geolizr.addEventListener('redirect.notExecuted', function(result) {
                body.removeClass('geolizr-redirect-loading');
                if(result.code === "200") {
                    body.addClass('geolizr-redirect-start');
                } else {
                    body.addClass('geolizr-redirect-blocked');
                }
            });
        });

        Geolizr.addSystemEventListener('geolizr.init.redirect', function(e) {
            let $ = e.jquery;
            const regex = /Mozilla\/(.*)AppleWebKit\/(.*)HeadlessChrome\/(.*)/gm;
            if(regex.exec(navigator.userAgent) === null) {
                Geolizr.getGeoData(function() {
                    Geolizr.redirects = {{ shop.metafields.geolizr.redirects }};
                    Geolizr.countryToRedirect = {{ shop.metafields.geolizr.country_to_redirect }};
                    Geolizr.redirect();
                }, true);
            } else {
                Geolizr.redirectExcutionMessage = `UserAgent Blocked [${navigator.userAgent}]`;
            }
        });
    </script>
{% endif %}